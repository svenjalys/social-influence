<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ article['Title'] }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      background-color: #f8f9fa;
    }

    .article_content {
      font-size: 1.1rem;
      line-height: 1.7;
      color: #222;
      font-family: Georgia, "Times New Roman", Times, serif;
    }

    .article_content p {
      margin-bottom: 1.25rem;
    }

    .label-badge {
      width: 26px;
      height: 26px;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .recommendation-card {
      cursor: pointer;
      transition: transform 0.2s ease-in-out;
    }

    .recommendation-card:hover {
      transform: translateY(-5px);
    }

    .article_body {
      font-family: 'Georgia', serif;
      font-size: 1.15rem;
      line-height: 1.8;
      color: #1a1a1a;
      /* margin-top: 2rem; */
    }

    .article_body p {
      margin-bottom: 1.5rem;
      text-align: justify;
    }

    .article_quote {
      border-left: 4px solid #ccc;
      padding-left: 1rem;
      margin: 1.5rem 0;
      font-style: italic;
      color: #444;
      background: #f8f9fa;
    }

    .article_metadata {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      font-style: italic;
    }
  </style>
</head>
<body class="container mt-5">

{% if debug %}
<div class="alert alert-warning">
  <strong>DEBUG:</strong><br>
  article_id: {{ article['index'] }}<br>
  round: {{ round_number }}
</div>
{% endif %}

<!-- <div class="d-flex justify-content-center mb-4">
  <div class="alert alert-primary text-center h4 mb-0 px-4 py-3" role="alert">
    <strong>Your task:</strong> Please have a look at the article. Then, out of the recommended related articles below, please choose the article you would most like to read.
  </div>
</div> -->

<div class="mx-auto" style="max-width: 800px;">
  <!-- Main Article -->
  <div class="mb-5">
    <h1 class="mb-3">{{ article['Title'] }}</h1>
    <img src="{{ article['Image URL'] or 'https://placehold.co/600x400?text=No+Image' }}" class="img-fluid mb-4">

    <div class="article_body">
      <div class="article_metadata">
        {{ article.get('Author', 'By Staff') }} | {{ article.get('Date', 'Published recently').split()[0] }}
      </div>

      {% set lines = article['Content'].split('\n') %}
      {% for line in lines[:8] %}
        <p>{{ line }}</p>
      {% endfor %}
      {% if lines|length > 8 %}
        <div id="moreContent" class="collapse">
          {% for line in lines[8:] %}
            <p>{{ line }}</p>
          {% endfor %}
        </div>
        <button class="btn btn-outline-primary btn-sm mt-2" type="button" id="toggleBtn" onclick="toggleContent()">Show more</button>
      {% endif %}
    </div>
  </div>

  <!-- Recommendations -->
  <h3>Recommended</h3>
  <form method="POST">
    <input type="hidden" name="selected_article_id" id="selected_article_id" value="">

    <div class="vstack gap-3">
      {% for rec in recommendations %}
      <div class="card text-start py-3 px-3 border-0 shadow-sm text-decoration-none text-body recommendation-card"
           onclick="submitSelection()">
        <div class="row g-3 align-items-center">
          <div class="col-md-8">
            <h3 class="mb-0 fw-bold" style="font-size: 1.5rem;">{{ rec['Title'] }}</h3>
          </div>
          <div class="col-md-4">
            <img src="{{ rec['Image URL'] or 'https://placehold.co/300x180?text=No+Image' }}"
                 class="img-fluid rounded mb-2"
                 style="max-height: 180px; object-fit: cover;">
            {% if rec.get('show_label') %}
              {% if condition == 'color' %}
                <img src="{{ url_for('static', filename='images/itsCOLOUR.png') }}" style="height: 30px;">
              {% elif condition == 'no_color' %}
                <img src="{{ url_for('static', filename='images/itsBW.png') }}" style="height: 30px;">
              {% elif condition == 'c2pa' %}
                <img src="{{ url_for('static', filename='images/cr_logo.png') }}" style="height: 30px;">
              {% endif %}
            {% endif %}
            {% if rec.get('show_label') %}
              {% if condition == 'color' %}
                <img src="{{ url_for('static', filename='images/itsCOLOUR.png') }}" style="height: 30px;">
              {% elif condition == 'no_color' %}
                <img src="{{ url_for('static', filename='images/itsBW.png') }}" style="height: 30px;">
              {% elif condition == 'c2pa' %}
                <img src="{{ url_for('static', filename='images/cr_logo.png') }}" style="height: 30px;">
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function submitSelection(articleId, hasLabel) {
    document.getElementById('selected_article_id').value = articleId;
    document.querySelector('form').submit();
  }

  function toggleContent() {
    const content = document.getElementById('moreContent');
    const btn = document.getElementById('toggleBtn');
    if (content.classList.contains('show')) {
      content.classList.remove('show');
      btn.textContent = 'Show more';
    } else {
      content.classList.add('show');
      btn.textContent = 'Show less';
    }
  }
</script>
</body>
</html>
