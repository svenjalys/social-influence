<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pre-Questionnaire</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            max-width: 900px;
            margin: 3rem auto;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .form-section {
            margin-bottom: 2rem;
        }
        h2 {
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        .likert-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        .likert-labels {
            display: flex;
            justify-content: space-between;
        }
        .form-check-input {
            border: 1px solid #6c757d;
        }
    </style>
    <!-- <script>
    function toggleOtherInput(checkbox, inputId) {
        const input = document.getElementById(inputId);
        if (checkbox.checked) {
        input.classList.remove('d-none');
        } else {
        input.classList.add('d-none');
        input.value = '';
        }
    }
    </script>
    <script>
        function toggleOtherInput(selectElem, inputId) {
            const input = document.getElementById(inputId);
            input.classList.toggle('hidden', selectElem.value !== 'Other');
            input.required = selectElem.value === 'Other';
        }
    </script>
    <script>
        function toggleOtherInput(checkbox, inputId) {
            const input = document.getElementById(inputId);
            if (checkbox.checked) {
                input.classList.remove('d-none');
            } else {
                input.classList.add('d-none');
                input.value = ''; // optional: clear input when hidden
            }
        }
        function validateForm() {
            let valid = true;

            // validate device question
            const deviceCheckboxes = document.querySelectorAll('input[name="device"]');
            const deviceError = document.getElementById('deviceError');
            const anyDeviceChecked = Array.from(deviceCheckboxes).some(cb => cb.checked);

            if (!anyDeviceChecked) {
            deviceError.classList.remove('d-none');
            valid = false;
            } else {
            deviceError.classList.add('d-none');
            }

            // validate source question
            const newsCheckboxes = document.querySelectorAll('input[name="news_sources"]:checked, input[name="sources_other"]:checked');
            const sourcesError = document.getElementById('sourcesError');

            if (newsCheckboxes.length === 0) {
            sourcesError.classList.remove('d-none');
            valid = false;
            } else {
            sourcesError.classList.add('d-none');
            }

            return valid;
        }
      </script> -->
      <script>
        // For checkboxes with "Other"
        function toggleCheckboxOther(checkbox, wrapperId) {
            const wrapper = document.getElementById(wrapperId);
            const input = wrapper.querySelector('input');
            if (checkbox.checked) {
                wrapper.classList.remove("hidden");
                input.required = true;
            } else {
                wrapper.classList.add("hidden");
                input.required = false;
                input.value = "";
            }
        }
        
        // For selects with "Other"
        function toggleSelectOther(selectElement, wrapperId) {
            const wrapper = document.getElementById(wrapperId);
            const input = wrapper.querySelector('input');
            if (selectElement.value === "Other") {
                wrapper.classList.remove("hidden");
                input.required = true;
            } else {
                wrapper.classList.add("hidden");
                input.required = false;
                input.value = "";
            }
        }
        
        // Validation
        function validateForm() {
            let valid = true;
            
            // validate device question
            const deviceCheckboxes = document.querySelectorAll('input[name="device"]');
            const deviceError = document.getElementById('deviceError');
            if (deviceCheckboxes.length && deviceError) {
                const anyDeviceChecked = Array.from(deviceCheckboxes).some(cb => cb.checked);
                if (!anyDeviceChecked) {
                    deviceError.classList.remove('hidden');
                    valid = false;
                } else {
                    deviceError.classList.add('hidden');
                }
            }
            
            // validate if "Other" is checked but no text is provided
            const otherCheckbox = document.getElementById('deviceOtherCheckbox');
            const otherInput = document.querySelector('input[name="device_other"]');
            if (otherCheckbox && otherInput && deviceError) {
                if (otherCheckbox.checked && !otherInput.value.trim()) {
                    deviceError.classList.remove('hidden');
                    deviceError.textContent = 'Please specify what device you use.';
                    valid = false;
                }
            }

            // validate last question (avoid_reasons): require 1-2 selections
            const avoidError = document.getElementById('avoidReasonsError');
            const avoidChecks = Array.from(document.querySelectorAll('input[name="avoid_reasons"]'));
            if (avoidChecks.length && avoidError) {
                const checked = avoidChecks.filter(cb => cb.checked);
                const otherReasonChecked = document.getElementById('reason_other')?.checked;
                const avoidOtherInput = document.querySelector('input[name="avoid_other"]');

                let msg = '';
                if (checked.length < 1) {
                    msg = 'Please select at least 1 reason.';
                } else if (checked.length > 2) {
                    msg = 'Please select no more than 2 reasons.';
                } else if (otherReasonChecked && avoidOtherInput && !avoidOtherInput.value.trim()) {
                    msg = 'Please specify your other reason.';
                }

                if (msg) {
                    avoidError.textContent = msg;
                    avoidError.classList.remove('hidden');
                    valid = false;
                } else {
                    avoidError.classList.add('hidden');
                }
            }
            
            return valid;
        }

        function toggleOtherInput(checkbox, wrapperId) {
            const wrapper = document.getElementById(wrapperId);
            const input = wrapper.querySelector('input');
            if (checkbox.checked) {
                wrapper.classList.remove('hidden');
                input.required = true;
            } else {
                wrapper.classList.add('hidden');
                input.required = false;
                input.value = '';
            }
        }

        function limitCheckboxes() {
            const checkboxes = document.querySelectorAll('input[name="avoid_reasons"]');
            const checked = document.querySelectorAll('input[name="avoid_reasons"]:checked');
            if (checked.length >= 2) {
                checkboxes.forEach(cb => {
                    if (!cb.checked) {
                        cb.disabled = true;
                    }
                });
            } else {
                checkboxes.forEach(cb => {
                    cb.disabled = false;
                });
            }
        }

        // Prevent selecting the same topic in Q3 vs Q4 and Q5 vs Q6.
        function enforceMutualExclusion(nameA, nameB) {
            const groupA = Array.from(document.querySelectorAll(`input[type="radio"][name="${nameA}"]`));
            const groupB = Array.from(document.querySelectorAll(`input[type="radio"][name="${nameB}"]`));
            if (!groupA.length || !groupB.length) return;

            function sync() {
                const selectedA = groupA.find(r => r.checked)?.value;
                const selectedB = groupB.find(r => r.checked)?.value;

                // Re-enable everything first
                groupA.forEach(r => r.disabled = false);
                groupB.forEach(r => r.disabled = false);

                // Disable A's selected value in B (unless B already chose it)
                if (selectedA) {
                    groupB.forEach(r => {
                        if (r.value === selectedA && !r.checked) r.disabled = true;
                    });
                }

                // Disable B's selected value in A (unless A already chose it)
                if (selectedB) {
                    groupA.forEach(r => {
                        if (r.value === selectedB && !r.checked) r.disabled = true;
                    });
                }
            }

            groupA.forEach(r => r.addEventListener('change', sync));
            groupB.forEach(r => r.addEventListener('change', sync));
            sync();
        }

        // Q3/Q4 (List A) and Q5/Q6 (List B)
        // Run after DOM is ready so the radio inputs exist.
        document.addEventListener('DOMContentLoaded', () => {
            enforceMutualExclusion('favourite_topic_1', 'least_favourite_topic_1');
            enforceMutualExclusion('favourite_topic_2', 'least_favourite_topic_2');
        });
        </script>
</head>
<body>
<div class="card">
    <h2 class="mb-4 text-center">Pre-Questionnaire</h2>
    <form method="POST" onsubmit="return validateForm();">

        <!-- 1. Frequency of reading news -->
        <div class="form-section">
            <label class="form-label">1. How often do you look at news on the internet?</label>
            <select class="form-select" name="news_frequency" required>
                <option disabled selected value>Select</option>
                <option>Several times a day</option>
                <option>Once a day</option>
                <option>Several times a week</option>
                <option>About once a week</option>
                <option>About once or twice a month</option>
                <option>Less than once a month</option>
                <option>Never</option>
            </select>
        </div>

        <!-- 2. Devices used -->
        <!-- <div class="form-section">
            <label class="form-label">2. Which device(s) do you typically use when looking at news on the internet?</label>
            <select class="form-select" name="device" onchange="toggleOtherInput(this, 'deviceOther')" required>
                <option disabled selected value>Select</option>
                <option>Mobile</option>
                <option>Computer/Laptop</option>
                <option>Tablet</option>
                <option>Other</option>
            </select>
            <input type="text" id="deviceOther" class="form-control mt-2 hidden" name="device_other" placeholder="Please specify if other">
        </div> -->
        <!-- <div class="form-section">
            <label class="form-label">2. Which device(s) do you typically use when looking at news on the internet?</label>
        
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="device" value="Mobile" id="deviceMobile">
              <label class="form-check-label" for="deviceMobile">Mobile</label>
            </div>
        
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="device" value="Computer/Laptop" id="deviceLaptop">
              <label class="form-check-label" for="deviceLaptop">Computer/Laptop</label>
            </div>
        
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="device" value="Tablet" id="deviceTablet">
              <label class="form-check-label" for="deviceTablet">Tablet</label>
            </div>
        
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="device" value="Other" id="deviceOtherCheckbox" onchange="toggleCheckboxOther(this, 'deviceOtherInput')">
              <label class="form-check-label" for="deviceOtherCheckbox">Other</label>
            </div>
        
            <div id="deviceOtherInput" class="hidden mt-2">
            <input type="text" name="device_other" class="form-control" placeholder="Please specify">
            </div>

            <div id="deviceError" class="text-danger mt-2 hidden">Please select at least one device.</div>
        </div> -->
          

        <!-- 3. Place of news consumption -->
        <div class="form-section">
            <label class="form-label">2. Where do you mostly consume news?</label>
            <select class="form-select" name="platform" onchange="toggleSelectOther(this, 'platformOtherInput')" required>
                <option disabled selected value>Select</option>
                <option>News websites</option>
                <option>News apps</option>
                <option>News aggregators (e.g. Google News, Apple News)</option>
                <option>Social media</option>
                <option value="Other">Other</option>
            </select>
            <div id="platformOtherInput" class="hidden mt-2">
                <input type="text" name="platform_other" class="form-control" placeholder="Please specify">
            </div>
            <!-- <input type="text" id="platformOther" class="form-control mt-2 hidden" name="platform_other" placeholder="Please specify"> -->
        </div>

        <!-- 3. Favourite topic from list A -->
        <div class="form-section">
            <label class="form-label">3. Please select your <u>most</u> favourite news topic from this list.</label>
            <div id="favouriteListA">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="Business & Economics" id="favA1" required>
                    <label class="form-check-label" for="favA1">Business & Economics</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="International News" id="favA2">
                    <label class="form-check-label" for="favA2">International News</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="Crime" id="favA3">
                    <label class="form-check-label" for="favA3">Crime</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="Finance" id="favA4">
                    <label class="form-check-label" for="favA4">Finance</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="Politics" id="favA5">
                    <label class="form-check-label" for="favA5">Politics</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_1" value="Public Health & Health Policy" id="favA6">
                    <label class="form-check-label" for="favA6">Public Health & Health Policy</label>
                </div>
            </div>
        </div>

        <!-- 4. Least favourite topic from list A -->
        <div class="form-section">
            <label class="form-label">4. Please select your <u>least</u> favourite news topic from this list.</label>
            <div id="leastFavouriteListA">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="Business & Economics" id="leastFavA1" required>
                    <label class="form-check-label" for="leastFavA1">Business & Economics</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="International News" id="leastFavA2">
                    <label class="form-check-label" for="leastFavA2">International News</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="Crime" id="leastFavA3">
                    <label class="form-check-label" for="leastFavA3">Crime</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="Finance" id="leastFavA4">
                    <label class="form-check-label" for="leastFavA4">Finance</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="Politics" id="leastFavA5">
                    <label class="form-check-label" for="leastFavA5">Politics</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_1" value="Public Health & Health Policy" id="leastFavA6">
                    <label class="form-check-label" for="leastFavA6">Public Health & Health Policy</label>
                </div>
            </div>
        </div>

        <!-- 5. Favourite topic from list B -->
        <div class="form-section">
            <label class="form-label">5. Please select your <u>most</u> favourite news topic from this list.</label>
            <div id="favouriteListB">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Lifestyle" id="favB1" required>
                    <label class="form-check-label" for="favB1">Lifestyle</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Entertainment" id="favB2">
                    <label class="form-check-label" for="favB2">Entertainment</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Science" id="favB3">
                    <label class="form-check-label" for="favB3">Science</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Tech" id="favB4">
                    <label class="form-check-label" for="favB4">Tech</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Sports" id="favB5">
                    <label class="form-check-label" for="favB5">Sports</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="favourite_topic_2" value="Personal Health & Wellbeing" id="favB6">
                    <label class="form-check-label" for="favB6">Personal Health & Wellbeing</label>
                </div>
            </div>
        </div>

        <!-- 6. Least favourite topic from list B -->
        <div class="form-section">
            <label class="form-label">6. Please select your <u>least</u> favourite news topic from this list.</label>
            <div id="leastFavouriteListB">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Lifestyle" id="leastFavB1" required>
                    <label class="form-check-label" for="leastFavB1">Lifestyle</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Entertainment" id="leastFavB2">
                    <label class="form-check-label" for="leastFavB2">Entertainment</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Science" id="leastFavB3">
                    <label class="form-check-label" for="leastFavB3">Science</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Tech" id="leastFavB4">
                    <label class="form-check-label" for="leastFavB4">Tech</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Sports" id="leastFavB5">
                    <label class="form-check-label" for="leastFavB5">Sports</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="least_favourite_topic_2" value="Personal Health & Wellbeing" id="leastFavB6">
                    <label class="form-check-label" for="leastFavB6">Personal Health & Wellbeing</label>
                </div>
            </div>
        </div>

        <!-- 7. Dynamic Likert for selected topics -->
        <div class="form-section">
            <label class="form-label">7. Please select how much you agree or disagree with the following statements about each topic:</label>

            <div class="mb-3">
                <label class="form-label d-flex justify-content-center"><em id="enjoyLabel1">I enjoy reading news about this topic.</em></label>
                <div class="likert-labels mb-2">
                    <small class="text-start">Strongly disagree</small>
                    <small class="text-end">Strongly agree</small>
                </div>
                <div class="likert-container">
                    <input type="radio" name="enjoy_topic_1" value="1" id="enjoy_topic_1_1" class="form-check-input" required>
                    <input type="radio" name="enjoy_topic_1" value="2" id="enjoy_topic_1_2" class="form-check-input">
                    <input type="radio" name="enjoy_topic_1" value="3" id="enjoy_topic_1_3" class="form-check-input">
                    <input type="radio" name="enjoy_topic_1" value="4" id="enjoy_topic_1_4" class="form-check-input">
                    <input type="radio" name="enjoy_topic_1" value="5" id="enjoy_topic_1_5" class="form-check-input">
                    <input type="radio" name="enjoy_topic_1" value="6" id="enjoy_topic_1_6" class="form-check-input">
                    <input type="radio" name="enjoy_topic_1" value="7" id="enjoy_topic_1_7" class="form-check-input">
                </div>
            </div>
<br>
            <div class="mb-3">
                <label class="form-label d-flex justify-content-center"><em id="enjoyLabel2">I enjoy reading news about this topic.</em></label>
                <div class="likert-labels mb-2">
                    <small class="text-start">Strongly disagree</small>
                    <small class="text-end">Strongly agree</small>
                </div>
                <div class="likert-container">
                    <input type="radio" name="enjoy_topic_2" value="1" id="enjoy_topic_2_1" class="form-check-input" required>
                    <input type="radio" name="enjoy_topic_2" value="2" id="enjoy_topic_2_2" class="form-check-input">
                    <input type="radio" name="enjoy_topic_2" value="3" id="enjoy_topic_2_3" class="form-check-input">
                    <input type="radio" name="enjoy_topic_2" value="4" id="enjoy_topic_2_4" class="form-check-input">
                    <input type="radio" name="enjoy_topic_2" value="5" id="enjoy_topic_2_5" class="form-check-input">
                    <input type="radio" name="enjoy_topic_2" value="6" id="enjoy_topic_2_6" class="form-check-input">
                    <input type="radio" name="enjoy_topic_2" value="7" id="enjoy_topic_2_7" class="form-check-input">
                </div>
            </div>
<br>
            <div class="mb-3">
                <label class="form-label d-flex justify-content-center"><em id="avoidLabel1">I usually avoid reading news about this topic.</em></label>
                <div class="likert-labels mb-2">
                    <small class="text-start">Strongly disagree</small>
                    <small class="text-end">Strongly agree</small>
                </div>
                <div class="likert-container">
                    <input type="radio" name="avoid_topic_1" value="1" id="avoid_topic_1_1" class="form-check-input" required>
                    <input type="radio" name="avoid_topic_1" value="2" id="avoid_topic_1_2" class="form-check-input">
                    <input type="radio" name="avoid_topic_1" value="3" id="avoid_topic_1_3" class="form-check-input">
                    <input type="radio" name="avoid_topic_1" value="4" id="avoid_topic_1_4" class="form-check-input">
                    <input type="radio" name="avoid_topic_1" value="5" id="avoid_topic_1_5" class="form-check-input">
                    <input type="radio" name="avoid_topic_1" value="6" id="avoid_topic_1_6" class="form-check-input">
                    <input type="radio" name="avoid_topic_1" value="7" id="avoid_topic_1_7" class="form-check-input">
                </div>
            </div>
<br>
            <div class="mb-3">
                <label class="form-label d-flex justify-content-center"><em id="avoidLabel2">I usually avoid reading news about this topic.</em></label>
                <div class="likert-labels mb-2">
                    <small class="text-start">Strongly disagree</small>
                    <small class="text-end">Strongly agree</small>
                </div>
                <div class="likert-container">
                    <input type="radio" name="avoid_topic_2" value="1" id="avoid_topic_2_1" class="form-check-input" required>
                    <input type="radio" name="avoid_topic_2" value="2" id="avoid_topic_2_2" class="form-check-input">
                    <input type="radio" name="avoid_topic_2" value="3" id="avoid_topic_2_3" class="form-check-input">
                    <input type="radio" name="avoid_topic_2" value="4" id="avoid_topic_2_4" class="form-check-input">
                    <input type="radio" name="avoid_topic_2" value="5" id="avoid_topic_2_5" class="form-check-input">
                    <input type="radio" name="avoid_topic_2" value="6" id="avoid_topic_2_6" class="form-check-input">
                    <input type="radio" name="avoid_topic_2" value="7" id="avoid_topic_2_7" class="form-check-input">
                </div>
            </div>
        </div>

        <!-- <div class="form-section">
            <p>13. Please indicate how much you agree or disagree with the following statements:</p>
            <label class="form-label">
                <em>I generally trust information from the news media in my country.</em>
            </label>
            <div class="likert-container">
                <label for="trust_1" class="me-2">1</label>
                <input type="radio" name="trust_level" value="1" id="trust_1" required>
                <input type="radio" name="trust_level" value="2" id="trust_2">
                <input type="radio" name="trust_level" value="3" id="trust_3">
                <input type="radio" name="trust_level" value="4" id="trust_4">
                <input type="radio" name="trust_level" value="5" id="trust_5">
                <input type="radio" name="trust_level" value="6" id="trust_6">
                <input type="radio" name="trust_level" value="7" id="trust_7">
                <label for="trust_7" class="ms-2">7</label>
            </div>
            <div class="likert-labels">
                <small class="text-start">Strongly disagree</small>
                <small class="text-end">Strongly agree</small>
            </div>
        </div> -->



                <!-- Attention check -->
        <div class="form-section">
            <label class="form-label">8. Among the following answers, please select “BBC”. This is an attention check.</label>
            <select class="form-select" name="attention_check" required>
                <option disabled selected value>Select</option>
                <option>New York Times</option>
                <option>CBS</option>
                <option>BBC</option>
                <option>The Guardian</option>
                <option>Washington Post</option>
                <option>Fox News</option>
            </select>
        </div>

        <!-- 9. Avoid news question -->
        <div class="form-section">
            <label class="form-label">9. Do you ever avoid the news about certain topics?</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="avoid_news" value="no" id="avoid_never" required>
                <label class="form-check-label" for="avoid_never">Never</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="avoid_news" value="occasionally" id="avoid_occasionally">
                <label class="form-check-label" for="avoid_occasionally">Occasionally (less than once a week)</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="avoid_news" value="regularly" id="avoid_sometimes">
                <label class="form-check-label" for="avoid_sometimes">Sometimes (about once a week)</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="avoid_news" value="particular_topics" id="avoid_often">
                <label class="form-check-label" for="avoid_often">Often (several times a week or more)</label>
            </div>
        </div>

        <!-- 10. Reasons for avoiding news -->
        <div class="form-section">
            <label class="form-label">10. What are your main reasons for avoiding the news? Please select 1 or 2 answers from the list below.</label>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="avoid_reasons" value="negative_mood" id="reason_negative" onchange="limitCheckboxes()">
                <label class="form-check-label" for="reason_negative">The news feels too negative and has an effect on my mood.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="avoid_reasons" value="too_much" id="reason_too_much" onchange="limitCheckboxes()">
                <label class="form-check-label" for="reason_too_much">The news feels too much or is too exhausting to follow.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="avoid_reasons" value="not_relevant" id="reason_not_relevant" onchange="limitCheckboxes()">
                <label class="form-check-label" for="reason_not_relevant">The news does not feel relevant to me.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="avoid_reasons" value="not_trust" id="reason_not_trust" onchange="limitCheckboxes()">
                <label class="form-check-label" for="reason_not_trust">I don't trust the news enough/it feels biased.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="avoid_reasons" value="other" id="reason_other" onchange="toggleOtherInput(this, 'other_reason_wrapper'); limitCheckboxes();">
                <label class="form-check-label" for="reason_other">Other (please specify)</label>
                <div id="other_reason_wrapper" class="hidden mt-2">
                    <input type="text" class="form-control" name="avoid_other" placeholder="Please specify">
                </div>
            </div>

            <div id="avoidReasonsError" class="text-danger mt-2 hidden">Please select at least 1 reason.</div>
        </div>

        <!-- Submit button -->
        <div class="text-end">
            <button type="submit" class="btn btn-primary">Continue</button>
        </div>
    </form>
</div>

<script>
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function _topicValuesFromContainer(container) {
    return Array.from(container.querySelectorAll('input[type="radio"]'))
        .map((el) => el.value)
        .filter((v) => v !== undefined && v !== null && String(v).length > 0);
}

function _reorderContainerByValue(container, valuesInOrder) {
    const items = Array.from(container.children);
    const valueToItem = new Map();
    const leftovers = [];

    for (const item of items) {
        const input = item.querySelector('input[type="radio"]');
        const v = input?.value;
        if (v) valueToItem.set(v, item);
        else leftovers.push(item);
    }

    const used = new Set();
    for (const v of valuesInOrder) {
        const item = valueToItem.get(v);
        if (item) {
            container.appendChild(item);
            used.add(v);
        }
    }

    // Append any items not covered by valuesInOrder (defensive).
    for (const [v, item] of valueToItem.entries()) {
        if (!used.has(v)) container.appendChild(item);
    }
    leftovers.forEach((item) => container.appendChild(item));
}

function applySharedRandomOrder(containerIdA, containerIdB) {
    const containerA = document.getElementById(containerIdA);
    const containerB = document.getElementById(containerIdB);
    if (!containerA || !containerB) return;

    // Shuffle once based on the topic values from A, then apply that order to both.
    const values = _topicValuesFromContainer(containerA);
    shuffleArray(values);
    _reorderContainerByValue(containerA, values);
    _reorderContainerByValue(containerB, values);
}

document.addEventListener('DOMContentLoaded', function() {
    // Q3/Q4 share order (List A); Q5/Q6 share order (List B)
    applySharedRandomOrder('favouriteListA', 'leastFavouriteListA');
    applySharedRandomOrder('favouriteListB', 'leastFavouriteListB');

    // Update labels dynamically
    function updateLabels() {
        const fav1 = document.querySelector('input[name="favourite_topic_1"]:checked');
        if (fav1) {
            document.getElementById('enjoyLabel1').textContent = `I enjoy reading news about ${fav1.value}.`;
        }

        const fav2 = document.querySelector('input[name="favourite_topic_2"]:checked');
        if (fav2) {
            document.getElementById('enjoyLabel2').textContent = `I enjoy reading news about ${fav2.value}.`;
        }

        const least1 = document.querySelector('input[name="least_favourite_topic_1"]:checked');
        if (least1) {
            document.getElementById('avoidLabel1').textContent = `I usually avoid reading news about ${least1.value}.`;
        }

        const least2 = document.querySelector('input[name="least_favourite_topic_2"]:checked');
        if (least2) {
            document.getElementById('avoidLabel2').textContent = `I usually avoid reading news about ${least2.value}.`;
        }
    }

    // Add event listeners to all topic radios
    document.querySelectorAll('input[name="favourite_topic_1"], input[name="favourite_topic_2"], input[name="least_favourite_topic_1"], input[name="least_favourite_topic_2"]').forEach(radio => {
        radio.addEventListener('change', updateLabels);
    });

    // Keep last-question validation responsive
    document.querySelectorAll('input[name="avoid_reasons"]').forEach(cb => {
        cb.addEventListener('change', () => {
            limitCheckboxes();
            // Re-run validation to hide/show error immediately
            validateForm();
        });
    });
    const avoidOther = document.querySelector('input[name="avoid_other"]');
    if (avoidOther) {
        avoidOther.addEventListener('input', () => validateForm());
    }
});
</script>
</body>
</html>
